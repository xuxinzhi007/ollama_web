# 🚀 智能LoRA训练系统

一键式LoRA微调到Ollama导入的完整解决方案，支持智能环境检测、自动文件匹配、实时训练监控。

## ⚡ 快速开始

**新用户首次运行**（自动环境设置）：
```bash
git clone <repository>
cd finetune
python smart_train.py  # 🎯 自动检测并引导环境设置
```

**日常使用**（统一入口）：
```bash
./train                    # 交互式选择角色训练
./train linzhi            # 直接训练林栀角色
./train linzhi --ollama   # 训练并导入Ollama
```

## 📁 项目结构

```
finetune/
├── 📄 README.md                    ← 你在这里！
├── 🚀 train                        ← 统一启动脚本（推荐）
├── 🧠 smart_train.py              ← 智能训练主脚本
├── 🔧 train_lora.py               ← LoRA训练引擎
├── 📄 character_configs.yaml      ← 角色配置文件
├── 📄 requirements.txt            ← Python依赖
│
├── 📂 datasets/                   ← 训练数据
│   ├── linzhi/                   ← 林栀数据集
│   │   ├── train.jsonl           ← 训练数据(450样本)
│   │   └── val.jsonl             ← 验证数据(50样本)
│   └── archive/                  ← 历史数据
├── 📂 out/                       ← 训练输出
└── 📂 .venv/                     ← 虚拟环境
```

## 🎯 核心功能

### 🔥 智能训练系统
- ✅ **智能环境检测**：自动检查Python、依赖、Ollama服务
- 📊 **自动文件匹配**：智能发现和匹配训练数据
- ⏰ **实时进度显示**：训练过程可视化监控
- 🎯 **一键导入Ollama**：训练完成自动导入使用

### 📱 完整功能菜单
```bash
./train --menu          # 完整功能菜单

🚀 智能LoRA训练系统 - 主菜单
1) 🎭 角色训练（智能文件匹配）
2) 📊 数据集管理
3) 🔍 系统状态检查
4) 🤖 Ollama模型管理
5) 🧪 模型测试
```

## 📋 使用指南

### 🎭 可用角色

**林栀（主角色）**: 450训练样本 + 50验证样本
**林栀(测试版)**: 28训练样本，快速测试用

### 🚀 训练流程

**标准训练流程:**
```bash
./train linzhi               # 开始训练
```

**训练完成后会自动显示:**
```
🎉 训练完成！下一步操作
✅ 模型已训练完成：linzhi
📁 文件位置：out/merged_linzhi/

⚠️  注意：模型目前还没有导入到Ollama，无法直接使用

📋 后续选项：
1) 🚀 导入到Ollama（推荐）
2) 📦 稍后导入
3) 🏠 返回主菜单
4) 👋 退出系统
```

**快速训练+导入:**
```bash
./train linzhi --ollama      # 训练后自动导入Ollama
```

**快速测试:**
```bash
./train linzhi_quick         # 使用28样本快速测试
```

### 🔧 系统管理

**环境检查:**
```bash
./train --env-check          # 全面环境诊断
./train --setup             # 环境初始化设置
./train --cache             # 检查模型缓存状态
```

**数据管理:**
```bash
./train --scan              # 扫描数据集状态
./train --list              # 查看所有角色配置
```

## 🛠️ 高级功能

### 💡 环境管理
- **首次运行检测**：自动识别新用户并引导设置
- **依赖自动安装**：智能检测并安装缺失的依赖
- **跨平台支持**：Windows/macOS/Linux全平台兼容
- **问题自动修复**：提供详细的解决方案

### 🎯 训练优化
- **智能参数调整**：根据数据量自动优化训练参数
- **断点续训支持**：支持继续训练已有模型
- **多格式数据支持**：自动识别不同格式的训练数据
- **质量验证**：训练前验证数据格式和质量

### 🤖 Ollama集成
- **一键导入**：训练完成自动导入Ollama
- **智能命名**：自动生成合适的模型名称
- **参数优化**：自动配置最佳推理参数
- **模型管理**：查看、测试、删除Ollama模型

## ❓ 问题排查

**数据找不到**: 运行 `./train --scan` 检查文件位置
**配置问题**: 运行 `./train --list` 查看配置状态
**环境问题**: 运行 `./train --env-check` 全面诊断
**格式错误**: 检查JSONL文件每行都是有效JSON

## 🚨 重要提醒

- **训练完成后需要导入Ollama才能使用** - 系统会自动提示选择
- 同时只运行一个训练任务，避免资源冲突
- 训练前运行 `./train --cache` 确认模型已缓存
- 使用 `./train linzhi_quick` 先做快速测试

## 🎯 一句话总结

**用 `./train` 就够了！** 新用户自动引导设置，老用户一键训练导入！

---
**统一入口**: `./train` | **完整功能**: `./train --menu`